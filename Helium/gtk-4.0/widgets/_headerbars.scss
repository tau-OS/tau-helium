assistant,
printdialog,
window.csd {
    > .titlebar {
        border-radius: rem(6px) rem(6px) 0 0;
    }
}

assistant,
printdialog,
window {
    headerbar,
    .titlebar {
        // Etched in the light style, shadow in the dark style
        $shadow: 0 1px rgba(white, 0.5);
        @if $color-scheme == "dark" {
            $shadow: 0 1px rgba(black, 0.67);
        }

        @extend %outset-background;
        background-color: #{"@color_primary"};
        color: $fg-color;

        .title {
            // Cannot be a number or fonts break in Flatpak
            font-weight: bold;
            text-shadow: $shadow
        }

        .subtitle {
            opacity: 0.5;
            font-size: 80%;
        }
    }

    &.csd {
        .titlebar {
            box-shadow:
                0 1px 0 0 #{'alpha(shade(@color_primary, 0.7), 0.4)'};
            padding: rem(6px);

            @if $color-scheme == "dark" {
                box-shadow:
                    0 0 0 1px #{'alpha(shade(@color_primary, 0.5), 0.5)'};
            }

            &:backdrop {
                box-shadow:
                    0 0 0 1px #{'alpha(shade(@color_primary, 0.7), 0.3)'};
            }

            &.default-decoration {
                padding: rem(3px);
            }

            &.flat {
                background: inherit;
                color: inherit;
            }
        }

        // Fixes double shadow in HdyTitleBar and Epiphany
        stack.titlebar headerbar,
        stack.titlebar headerbar:backdrop {
            box-shadow: none;
            padding: 0;
        }

        revealer headerbar {
            // Box shadow can't overlay content
            border-bottom: 1px solid $toplevel-border-color;
            border-radius: rem(6px) rem(6px) 0 0;
            padding: rem(6px);
        }
    }

    // Hdy.Window
    &.unified {
        .titlebar {
            box-shadow:
                0 1px 0 #{'alpha(shade(@color_primary, 0.7), 0.4)'};

            @if $color-scheme == "dark" {
                box-shadow:
                    0 1px 0 #{'alpha(shade(@color_primary, 0.5), 0.5)'};
            }

            &:backdrop:not(.flat) {
                box-shadow:
                    0 1px 0 0 #{'alpha(shade(@color_primary, 0.7), 0.3)'};
            }
        }
    }

    // SSD doesn't calculate rems correctly
    &.ssd .titlebar {
        // Box shadow can't overlay content
        border-bottom: 1px solid $toplevel-border-color;
        border-radius: 12px 12px 0 0;
        padding: 3px;

        button {
            border-radius: 8px;
            padding: 3px;
        }
    }
}

window.dialog.csd > .titlebar {
    @extend .flat;
}
